{
  "version": 3,
  "sources": ["../src/Session.ts"],
  "sourcesContent": ["const $storage = Symbol(\"object\");\n\n/**\n * Bag of key-values associated with the current actor running this request or action\n **/\nexport class Session {\n  static fromInput(input?: Record<string, any>) {\n    if (input) {\n      return new Session(input.id, input);\n    }\n  }\n\n  changedKeys = new Set<string>();\n  ended = false;\n  [$storage]: Record<string, any>;\n\n  constructor(private _id: string | null, obj: Record<string, any>) {\n    this[$storage] = obj;\n  }\n\n  get(key: string) {\n    return this[$storage][key];\n  }\n\n  set(key: string, value: any) {\n    this.changedKeys.add(key);\n    this[$storage][key] = value;\n  }\n\n  delete(key: string) {\n    this.changedKeys.add(key);\n    this[$storage][key] = null;\n  }\n\n  end() {\n    this.changedKeys.add(\"id\");\n    this.ended = true;\n  }\n\n  clearChanges() {\n    this.changedKeys.clear();\n  }\n\n  get changed() {\n    return this.changedKeys.size > 0;\n  }\n\n  toJSON() {\n    return this[$storage];\n  }\n\n  toChangedJSON() {\n    const changes: Record<string, any> = {};\n    for (const key of this.changedKeys) {\n      changes[key] = this[$storage][key];\n    }\n    return changes;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  set id(value: string | null) {\n    this._id = value;\n    this.set(\"id\", this._id);\n  }\n}\n"],
  "mappings": "AAAA,MAAM,WAAW,OAAO,QAAQ;AAKzB,MAAM,WAAN,MAAc;AAAA,EAWnB,YAAoB,KAAoB,KAA0B;AAA9C;AAJpB,uBAAc,oBAAI,IAAY;AAC9B,iBAAQ;AAIN,SAAK,QAAQ,IAAI;AAAA,EACnB;AAAA,EAZA,OAAO,UAAU,OAA6B;AAC5C,QAAI,OAAO;AACT,aAAO,IAAI,SAAQ,MAAM,IAAI,KAAK;AAAA,IACpC;AAAA,EACF;AAAA,EAUA,IAAI,KAAa;AACf,WAAO,KAAK,QAAQ,EAAE,GAAG;AAAA,EAC3B;AAAA,EAEA,IAAI,KAAa,OAAY;AAC3B,SAAK,YAAY,IAAI,GAAG;AACxB,SAAK,QAAQ,EAAE,GAAG,IAAI;AAAA,EACxB;AAAA,EAEA,OAAO,KAAa;AAClB,SAAK,YAAY,IAAI,GAAG;AACxB,SAAK,QAAQ,EAAE,GAAG,IAAI;AAAA,EACxB;AAAA,EAEA,MAAM;AACJ,SAAK,YAAY,IAAI,IAAI;AACzB,SAAK,QAAQ;AAAA,EACf;AAAA,EAEA,eAAe;AACb,SAAK,YAAY,MAAM;AAAA,EACzB;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,KAAK,YAAY,OAAO;AAAA,EACjC;AAAA,EAEA,SAAS;AACP,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,gBAAgB;AACd,UAAM,UAA+B,CAAC;AACtC,eAAW,OAAO,KAAK,aAAa;AAClC,cAAQ,GAAG,IAAI,KAAK,QAAQ,EAAE,GAAG;AAAA,IACnC;AACA,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,KAAK;AACP,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,GAAG,OAAsB;AAC3B,SAAK,MAAM;AACX,SAAK,IAAI,MAAM,KAAK,GAAG;AAAA,EACzB;AACF;AA9DO,IAAM,UAAN;AASJ;",
  "names": []
}
